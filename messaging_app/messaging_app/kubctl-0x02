#!/bin/bash

# Deploy both blue and green versions
echo "ğŸš€ Applying blue deployment..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Applying green deployment..."
kubectl apply -f green_deployment.yaml

# Wait for pods to start
echo "â³ Waiting for green pods to initialize..."
sleep 10

# Get green pods
echo "ğŸ” Listing green pods:"
kubectl get pods -l app=messaging-app,version=green

# Check logs of green pods
echo "ğŸ“„ Checking logs of green pods for errors..."

green_pods=$(kubectl get pods -l app=messaging-app,version=green -o jsonpath='{.items[*].metadata.name}')

for pod in $green_pods; do
  echo "ğŸ“‹ Logs for pod: $pod"
  kubectl logs "$pod"
  echo "--------------------------------------"
done

echo "âœ… If logs look good, run:"
echo "kubectl apply -f kubeservice.yaml   # (after changing service selector to 'green')"
